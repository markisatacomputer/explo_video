"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){function e(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){return n.reject(e)})})}var t=setTimeout;function o(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(e,this)}function r(n,o){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,i._immediateFn(function(){var e=1===n._state?o.onFulfilled:o.onRejected;if(null!==e){var t;try{t=e(n._value)}catch(e){return void u(o.promise,e)}f(o.promise,t)}else(1===n._state?f:u)(o.promise,n._value)})):n._deferreds.push(o)}function f(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===_typeof(e)||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void c(t);if("function"==typeof n)return void a((o=n,r=e,function(){o.apply(r,arguments)}),t)}t._state=1,t._value=e,c(t)}catch(e){u(t,e)}var o,r}function u(e,t){e._state=2,e._value=t,c(e)}function c(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)r(e,e._deferreds[t]);e._deferreds=null}function l(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function a(e,t){var n=!1;try{e(function(e){n||(n=!0,f(t,e))},function(e){n||(n=!0,u(t,e))})}catch(e){if(n)return;n=!0,u(t,e)}}i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=new this.constructor(o);return r(this,new l(e,t,n)),n},i.prototype.finally=e,i.all=function(t){return new i(function(o,r){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var i=Array.prototype.slice.call(t);if(0===i.length)return o([]);var f=i.length;function u(t,e){try{if(e&&("object"===_typeof(e)||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){u(t,e)},r)}i[t]=e,0==--f&&o(i)}catch(e){r(e)}}for(var e=0;e<i.length;e++)u(e,i[e])})},i.resolve=function(t){return t&&"object"===_typeof(t)&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(n){return new i(function(e,t){t(n)})},i.race=function(r){return new i(function(e,t){for(var n=0,o=r.length;n<o;n++)r[n].then(e,t)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in n?n.Promise.prototype.finally||(n.Promise.prototype.finally=e):n.Promise=i});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb21pc2VzLXBvbHlmaWxsLmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsImZhY3RvcnkiLCJleHBvcnRzIiwiX3R5cGVvZiIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsImZpbmFsbHlDb25zdHJ1Y3RvciIsImNhbGxiYWNrIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwicmVzb2x2ZSIsInZhbHVlIiwidGhlbiIsInJlYXNvbiIsInJlamVjdCIsInNldFRpbWVvdXRGdW5jIiwic2V0VGltZW91dCIsIm5vb3AiLCJQcm9taXNlIiwiVHlwZUVycm9yIiwiZm4iLCJfc3RhdGUiLCJfaGFuZGxlZCIsIl92YWx1ZSIsInVuZGVmaW5lZCIsIl9kZWZlcnJlZHMiLCJkb1Jlc29sdmUiLCJoYW5kbGUiLCJzZWxmIiwiZGVmZXJyZWQiLCJfaW1tZWRpYXRlRm4iLCJjYiIsIm9uRnVsZmlsbGVkIiwib25SZWplY3RlZCIsInJldCIsImUiLCJwcm9taXNlIiwicHVzaCIsIm5ld1ZhbHVlIiwiZmluYWxlIiwidGhpc0FyZyIsImFwcGx5IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiX3VuaGFuZGxlZFJlamVjdGlvbkZuIiwiaSIsImxlbiIsIkhhbmRsZXIiLCJkb25lIiwiZXgiLCJwcm90b3R5cGUiLCJwcm9tIiwiYXJyIiwiYXJncyIsIkFycmF5Iiwic2xpY2UiLCJjYWxsIiwicmVtYWluaW5nIiwicmVzIiwidmFsIiwicmFjZSIsInZhbHVlcyIsInNldEltbWVkaWF0ZSIsImVyciIsImNvbnNvbGUiLCJ3YXJuIiwiZ2xvYmFsTlMiLCJ3aW5kb3ciLCJFcnJvciJdLCJtYXBwaW5ncyI6IitQQUVDLFNBQVVBLEVBQVFDLEdBQ0MsWUFBbkIsb0JBQU9DLFFBQVAsWUFBQUMsUUFBT0QsV0FBMEMsb0JBQVhFLE9BQXlCSCxJQUhoRSxtQkFBQUksUUFBQUEsT0FBQUMsSUFBQUQsT0FBQUosR0FFQ0EsSUFBQSxDQUFBLEVBQ0EsV0FRRCxTQUFTTSxFQUFtQkMsR0FDMUIsSUFBSUMsRUFB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LEdBNENJQSxFQUFRQyxNQUhUTyxFQUFBSixPQUFBLFNBQUFILEdBUUQsT0FBTyxJQUFJTyxFQUFRLFNBQVNSLEVBQVNJLEdBTnJDQSxFQUFPSCxNQVdUTyxFQUFRMEMsS0FBTyxTQUFTQyxHQU54QjNDLE9BQU8sSUFBQ0osRUFBUyxTQUFTSCxFQUFPRyxHQUMvQixJQUFBLElBQU8rQixFQUFJM0IsRUFBQUEsRUFBUTJDLEVBQVNuRCxPQUFUbUMsRUFBa0IvQixFQUFRK0IsSUFDM0MvQixFQUFPSCxHQUFBQSxLQUFQRCxFQUFBSSxNQU1BSSxFQUFBWSxhQUNpQnBCLG1CQUFmbUQsY0FDRCxTQUFBekMsR0FISDBDLGFBQUExQyxLQWFBLFNBQVNBLEdBQ1BMLEVBQWVLLEVBQUksSUFGbEJGLEVBQ0gwQixzQkFBYSxTQUFBbUIsR0FDWCxvQkFBQWhELFNBQUFpRCxTQU5KQSxRQUFBQyxLQUFBLHdDQUFBRixJQVlHLElBQUFHLEVBQUEsV0FRRCxHQUFvQixvQkFBVHRDLEtBSmIsT0FBSXNDLEtBRUYsR0FBQSxvQkFBQUMsT0FDQSxPQUFBQSxPQUVFLEdBQUEsb0JBQU92QyxPQUNSLE9BQUE3QixPQUNELE1BQUksSUFBQXFFLE1BQU9ELGtDQVhWLEdBb0JHLFlBQWFELEVBTGZBLEVBQUFoRCxRQUFBZ0MsVUFBQSxVQUNEZ0IsRUFBQWhELFFBQUFnQyxVQUFBLFFBQUE1QyxHQUZENEQsRUFBSSxRQUFBaEQiLCJmaWxlIjoicHJvbWlzZXMtcG9seWZpbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9odHRwczovL2dpdGh1Yi5jb20vdGF5bG9yaGFrZXMvcHJvbWlzZS1wb2x5ZmlsbFxuXG4oZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkge1xuXHR0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBmYWN0b3J5KCkgOlxuXHR0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOlxuXHQoZmFjdG9yeSgpKTtcbn0odGhpcywgKGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEB0aGlzIHtQcm9taXNlfVxuICovXG5mdW5jdGlvbiBmaW5hbGx5Q29uc3RydWN0b3IoY2FsbGJhY2spIHtcbiAgdmFyIGNvbnN0cnVjdG9yID0gdGhpcy5jb25zdHJ1Y3RvcjtcbiAgcmV0dXJuIHRoaXMudGhlbihcbiAgICBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmV0dXJuIGNvbnN0cnVjdG9yLnJlc29sdmUoY2FsbGJhY2soKSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBmdW5jdGlvbihyZWFzb24pIHtcbiAgICAgIHJldHVybiBjb25zdHJ1Y3Rvci5yZXNvbHZlKGNhbGxiYWNrKCkpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBjb25zdHJ1Y3Rvci5yZWplY3QocmVhc29uKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgKTtcbn1cblxuLy8gU3RvcmUgc2V0VGltZW91dCByZWZlcmVuY2Ugc28gcHJvbWlzZS1wb2x5ZmlsbCB3aWxsIGJlIHVuYWZmZWN0ZWQgYnlcbi8vIG90aGVyIGNvZGUgbW9kaWZ5aW5nIHNldFRpbWVvdXQgKGxpa2Ugc2lub24udXNlRmFrZVRpbWVycygpKVxudmFyIHNldFRpbWVvdXRGdW5jID0gc2V0VGltZW91dDtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbi8vIFBvbHlmaWxsIGZvciBGdW5jdGlvbi5wcm90b3R5cGUuYmluZFxuZnVuY3Rpb24gYmluZChmbiwgdGhpc0FyZykge1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgZm4uYXBwbHkodGhpc0FyZywgYXJndW1lbnRzKTtcbiAgfTtcbn1cblxuLyoqXG4gKiBAY29uc3RydWN0b3JcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuXG4gKi9cbmZ1bmN0aW9uIFByb21pc2UoZm4pIHtcbiAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFByb21pc2UpKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Byb21pc2VzIG11c3QgYmUgY29uc3RydWN0ZWQgdmlhIG5ldycpO1xuICBpZiAodHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdub3QgYSBmdW5jdGlvbicpO1xuICAvKiogQHR5cGUgeyFudW1iZXJ9ICovXG4gIHRoaXMuX3N0YXRlID0gMDtcbiAgLyoqIEB0eXBlIHshYm9vbGVhbn0gKi9cbiAgdGhpcy5faGFuZGxlZCA9IGZhbHNlO1xuICAvKiogQHR5cGUge1Byb21pc2V8dW5kZWZpbmVkfSAqL1xuICB0aGlzLl92YWx1ZSA9IHVuZGVmaW5lZDtcbiAgLyoqIEB0eXBlIHshQXJyYXk8IUZ1bmN0aW9uPn0gKi9cbiAgdGhpcy5fZGVmZXJyZWRzID0gW107XG5cbiAgZG9SZXNvbHZlKGZuLCB0aGlzKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlKHNlbGYsIGRlZmVycmVkKSB7XG4gIHdoaWxlIChzZWxmLl9zdGF0ZSA9PT0gMykge1xuICAgIHNlbGYgPSBzZWxmLl92YWx1ZTtcbiAgfVxuICBpZiAoc2VsZi5fc3RhdGUgPT09IDApIHtcbiAgICBzZWxmLl9kZWZlcnJlZHMucHVzaChkZWZlcnJlZCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHNlbGYuX2hhbmRsZWQgPSB0cnVlO1xuICBQcm9taXNlLl9pbW1lZGlhdGVGbihmdW5jdGlvbigpIHtcbiAgICB2YXIgY2IgPSBzZWxmLl9zdGF0ZSA9PT0gMSA/IGRlZmVycmVkLm9uRnVsZmlsbGVkIDogZGVmZXJyZWQub25SZWplY3RlZDtcbiAgICBpZiAoY2IgPT09IG51bGwpIHtcbiAgICAgIChzZWxmLl9zdGF0ZSA9PT0gMSA/IHJlc29sdmUgOiByZWplY3QpKGRlZmVycmVkLnByb21pc2UsIHNlbGYuX3ZhbHVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHJldDtcbiAgICB0cnkge1xuICAgICAgcmV0ID0gY2Ioc2VsZi5fdmFsdWUpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJlamVjdChkZWZlcnJlZC5wcm9taXNlLCBlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmVzb2x2ZShkZWZlcnJlZC5wcm9taXNlLCByZXQpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZShzZWxmLCBuZXdWYWx1ZSkge1xuICB0cnkge1xuICAgIC8vIFByb21pc2UgUmVzb2x1dGlvbiBQcm9jZWR1cmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9taXNlcy1hcGx1cy9wcm9taXNlcy1zcGVjI3RoZS1wcm9taXNlLXJlc29sdXRpb24tcHJvY2VkdXJlXG4gICAgaWYgKG5ld1ZhbHVlID09PSBzZWxmKVxuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQSBwcm9taXNlIGNhbm5vdCBiZSByZXNvbHZlZCB3aXRoIGl0c2VsZi4nKTtcbiAgICBpZiAoXG4gICAgICBuZXdWYWx1ZSAmJlxuICAgICAgKHR5cGVvZiBuZXdWYWx1ZSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIG5ld1ZhbHVlID09PSAnZnVuY3Rpb24nKVxuICAgICkge1xuICAgICAgdmFyIHRoZW4gPSBuZXdWYWx1ZS50aGVuO1xuICAgICAgaWYgKG5ld1ZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xuICAgICAgICBzZWxmLl9zdGF0ZSA9IDM7XG4gICAgICAgIHNlbGYuX3ZhbHVlID0gbmV3VmFsdWU7XG4gICAgICAgIGZpbmFsZShzZWxmKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhlbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBkb1Jlc29sdmUoYmluZCh0aGVuLCBuZXdWYWx1ZSksIHNlbGYpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIHNlbGYuX3N0YXRlID0gMTtcbiAgICBzZWxmLl92YWx1ZSA9IG5ld1ZhbHVlO1xuICAgIGZpbmFsZShzZWxmKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJlamVjdChzZWxmLCBlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZWplY3Qoc2VsZiwgbmV3VmFsdWUpIHtcbiAgc2VsZi5fc3RhdGUgPSAyO1xuICBzZWxmLl92YWx1ZSA9IG5ld1ZhbHVlO1xuICBmaW5hbGUoc2VsZik7XG59XG5cbmZ1bmN0aW9uIGZpbmFsZShzZWxmKSB7XG4gIGlmIChzZWxmLl9zdGF0ZSA9PT0gMiAmJiBzZWxmLl9kZWZlcnJlZHMubGVuZ3RoID09PSAwKSB7XG4gICAgUHJvbWlzZS5faW1tZWRpYXRlRm4oZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXNlbGYuX2hhbmRsZWQpIHtcbiAgICAgICAgUHJvbWlzZS5fdW5oYW5kbGVkUmVqZWN0aW9uRm4oc2VsZi5fdmFsdWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNlbGYuX2RlZmVycmVkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGhhbmRsZShzZWxmLCBzZWxmLl9kZWZlcnJlZHNbaV0pO1xuICB9XG4gIHNlbGYuX2RlZmVycmVkcyA9IG51bGw7XG59XG5cbi8qKlxuICogQGNvbnN0cnVjdG9yXG4gKi9cbmZ1bmN0aW9uIEhhbmRsZXIob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQsIHByb21pc2UpIHtcbiAgdGhpcy5vbkZ1bGZpbGxlZCA9IHR5cGVvZiBvbkZ1bGZpbGxlZCA9PT0gJ2Z1bmN0aW9uJyA/IG9uRnVsZmlsbGVkIDogbnVsbDtcbiAgdGhpcy5vblJlamVjdGVkID0gdHlwZW9mIG9uUmVqZWN0ZWQgPT09ICdmdW5jdGlvbicgPyBvblJlamVjdGVkIDogbnVsbDtcbiAgdGhpcy5wcm9taXNlID0gcHJvbWlzZTtcbn1cblxuLyoqXG4gKiBUYWtlIGEgcG90ZW50aWFsbHkgbWlzYmVoYXZpbmcgcmVzb2x2ZXIgZnVuY3Rpb24gYW5kIG1ha2Ugc3VyZVxuICogb25GdWxmaWxsZWQgYW5kIG9uUmVqZWN0ZWQgYXJlIG9ubHkgY2FsbGVkIG9uY2UuXG4gKlxuICogTWFrZXMgbm8gZ3VhcmFudGVlcyBhYm91dCBhc3luY2hyb255LlxuICovXG5mdW5jdGlvbiBkb1Jlc29sdmUoZm4sIHNlbGYpIHtcbiAgdmFyIGRvbmUgPSBmYWxzZTtcbiAgdHJ5IHtcbiAgICBmbihcbiAgICAgIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIGlmIChkb25lKSByZXR1cm47XG4gICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgICByZXNvbHZlKHNlbGYsIHZhbHVlKTtcbiAgICAgIH0sXG4gICAgICBmdW5jdGlvbihyZWFzb24pIHtcbiAgICAgICAgaWYgKGRvbmUpIHJldHVybjtcbiAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgIHJlamVjdChzZWxmLCByZWFzb24pO1xuICAgICAgfVxuICAgICk7XG4gIH0gY2F0Y2ggKGV4KSB7XG4gICAgaWYgKGRvbmUpIHJldHVybjtcbiAgICBkb25lID0gdHJ1ZTtcbiAgICByZWplY3Qoc2VsZiwgZXgpO1xuICB9XG59XG5cblByb21pc2UucHJvdG90eXBlWydjYXRjaCddID0gZnVuY3Rpb24ob25SZWplY3RlZCkge1xuICByZXR1cm4gdGhpcy50aGVuKG51bGwsIG9uUmVqZWN0ZWQpO1xufTtcblxuUHJvbWlzZS5wcm90b3R5cGUudGhlbiA9IGZ1bmN0aW9uKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7XG4gIC8vIEB0cy1pZ25vcmVcbiAgdmFyIHByb20gPSBuZXcgdGhpcy5jb25zdHJ1Y3Rvcihub29wKTtcblxuICBoYW5kbGUodGhpcywgbmV3IEhhbmRsZXIob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQsIHByb20pKTtcbiAgcmV0dXJuIHByb207XG59O1xuXG5Qcm9taXNlLnByb3RvdHlwZVsnZmluYWxseSddID0gZmluYWxseUNvbnN0cnVjdG9yO1xuXG5Qcm9taXNlLmFsbCA9IGZ1bmN0aW9uKGFycikge1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgaWYgKCFhcnIgfHwgdHlwZW9mIGFyci5sZW5ndGggPT09ICd1bmRlZmluZWQnKVxuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignUHJvbWlzZS5hbGwgYWNjZXB0cyBhbiBhcnJheScpO1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJyKTtcbiAgICBpZiAoYXJncy5sZW5ndGggPT09IDApIHJldHVybiByZXNvbHZlKFtdKTtcbiAgICB2YXIgcmVtYWluaW5nID0gYXJncy5sZW5ndGg7XG5cbiAgICBmdW5jdGlvbiByZXMoaSwgdmFsKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAodmFsICYmICh0eXBlb2YgdmFsID09PSAnb2JqZWN0JyB8fCB0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgIHZhciB0aGVuID0gdmFsLnRoZW47XG4gICAgICAgICAgaWYgKHR5cGVvZiB0aGVuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICB0aGVuLmNhbGwoXG4gICAgICAgICAgICAgIHZhbCxcbiAgICAgICAgICAgICAgZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgcmVzKGksIHZhbCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHJlamVjdFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYXJnc1tpXSA9IHZhbDtcbiAgICAgICAgaWYgKC0tcmVtYWluaW5nID09PSAwKSB7XG4gICAgICAgICAgcmVzb2x2ZShhcmdzKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgcmVqZWN0KGV4KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlcyhpLCBhcmdzW2ldKTtcbiAgICB9XG4gIH0pO1xufTtcblxuUHJvbWlzZS5yZXNvbHZlID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUuY29uc3RydWN0b3IgPT09IFByb21pc2UpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgIHJlc29sdmUodmFsdWUpO1xuICB9KTtcbn07XG5cblByb21pc2UucmVqZWN0ID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgIHJlamVjdCh2YWx1ZSk7XG4gIH0pO1xufTtcblxuUHJvbWlzZS5yYWNlID0gZnVuY3Rpb24odmFsdWVzKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdmFsdWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICB2YWx1ZXNbaV0udGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vLyBVc2UgcG9seWZpbGwgZm9yIHNldEltbWVkaWF0ZSBmb3IgcGVyZm9ybWFuY2UgZ2FpbnNcblByb21pc2UuX2ltbWVkaWF0ZUZuID1cbiAgKHR5cGVvZiBzZXRJbW1lZGlhdGUgPT09ICdmdW5jdGlvbicgJiZcbiAgICBmdW5jdGlvbihmbikge1xuICAgICAgc2V0SW1tZWRpYXRlKGZuKTtcbiAgICB9KSB8fFxuICBmdW5jdGlvbihmbikge1xuICAgIHNldFRpbWVvdXRGdW5jKGZuLCAwKTtcbiAgfTtcblxuUHJvbWlzZS5fdW5oYW5kbGVkUmVqZWN0aW9uRm4gPSBmdW5jdGlvbiBfdW5oYW5kbGVkUmVqZWN0aW9uRm4oZXJyKSB7XG4gIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZSkge1xuICAgIGNvbnNvbGUud2FybignUG9zc2libGUgVW5oYW5kbGVkIFByb21pc2UgUmVqZWN0aW9uOicsIGVycik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZVxuICB9XG59O1xuXG4vKiogQHN1cHByZXNzIHt1bmRlZmluZWRWYXJzfSAqL1xudmFyIGdsb2JhbE5TID0gKGZ1bmN0aW9uKCkge1xuICAvLyB0aGUgb25seSByZWxpYWJsZSBtZWFucyB0byBnZXQgdGhlIGdsb2JhbCBvYmplY3QgaXNcbiAgLy8gYEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKClgXG4gIC8vIEhvd2V2ZXIsIHRoaXMgY2F1c2VzIENTUCB2aW9sYXRpb25zIGluIENocm9tZSBhcHBzLlxuICBpZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIHNlbGY7XG4gIH1cbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIHdpbmRvdztcbiAgfVxuICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gZ2xvYmFsO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcigndW5hYmxlIHRvIGxvY2F0ZSBnbG9iYWwgb2JqZWN0Jyk7XG59KSgpO1xuXG5pZiAoISgnUHJvbWlzZScgaW4gZ2xvYmFsTlMpKSB7XG4gIGdsb2JhbE5TWydQcm9taXNlJ10gPSBQcm9taXNlO1xufSBlbHNlIGlmICghZ2xvYmFsTlMuUHJvbWlzZS5wcm90b3R5cGVbJ2ZpbmFsbHknXSkge1xuICBnbG9iYWxOUy5Qcm9taXNlLnByb3RvdHlwZVsnZmluYWxseSddID0gZmluYWxseUNvbnN0cnVjdG9yO1xufVxuXG59KSkpO1xuIl19
